<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é€šçŸ¥åŠŸèƒ½æ¸¬è©¦</title>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#00aaff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="é€šçŸ¥æ¸¬è©¦" />
  <meta name="mobile-web-app-capable" content="yes" />
  
  <!-- Manifest -->
  <link rel="manifest" href="/manifest.json" />
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="/icons/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: #ffffff;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    h1 {
      text-align: center;
      color: #00aaff;
      margin-bottom: 30px;
      font-size: 2em;
    }
    
    .status-card {
      background: rgba(0, 170, 255, 0.1);
      border: 1px solid rgba(0, 170, 255, 0.3);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
    }
    
    .status-label {
      font-weight: bold;
      color: #e0e0e0;
    }
    
    .status-value {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
    }
    
    .status-success {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
      border: 1px solid rgba(76, 175, 80, 0.3);
    }
    
    .status-error {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
      border: 1px solid rgba(244, 67, 54, 0.3);
    }
    
    .status-warning {
      background: rgba(255, 152, 0, 0.2);
      color: #ff9800;
      border: 1px solid rgba(255, 152, 0, 0.3);
    }
    
    .test-buttons {
      display: grid;
      gap: 15px;
      margin-top: 30px;
    }
    
    .test-btn {
      background: linear-gradient(45deg, #00aaff, #0088cc);
      color: white;
      border: none;
      padding: 15px 25px;
      border-radius: 12px;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 170, 255, 0.3);
    }
    
    .test-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 170, 255, 0.4);
    }
    
    .test-btn:active {
      transform: translateY(0);
    }
    
    .test-btn:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .back-btn {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 12px 20px;
      border-radius: 8px;
      text-decoration: none;
      display: inline-block;
      margin-top: 20px;
      transition: all 0.3s ease;
    }
    
    .back-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .log {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.9em;
    }
    
    .log-entry {
      margin-bottom: 5px;
      padding: 5px;
      border-radius: 4px;
    }
    
    .log-info {
      background: rgba(0, 170, 255, 0.1);
      color: #00aaff;
    }
    
    .log-success {
      background: rgba(76, 175, 80, 0.1);
      color: #4caf50;
    }
    
    .log-error {
      background: rgba(244, 67, 54, 0.1);
      color: #f44336;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”” é€šçŸ¥åŠŸèƒ½æ¸¬è©¦</h1>
    
    <div class="status-card">
      <h3>ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h3>
      <div class="status-item">
        <span class="status-label">Service Worker æ”¯æ´</span>
        <span class="status-value" id="sw-support">æª¢æŸ¥ä¸­...</span>
      </div>
      <div class="status-item">
        <span class="status-label">æ¨é€é€šçŸ¥æ”¯æ´</span>
        <span class="status-value" id="push-support">æª¢æŸ¥ä¸­...</span>
      </div>
      <div class="status-item">
        <span class="status-label">é€šçŸ¥æ¬Šé™</span>
        <span class="status-value" id="notification-permission">æª¢æŸ¥ä¸­...</span>
      </div>
      <div class="status-item">
        <span class="status-label">PWA å®‰è£ç‹€æ…‹</span>
        <span class="status-value" id="pwa-status">æª¢æŸ¥ä¸­...</span>
      </div>
    </div>
    
    <div class="test-buttons">
      <button class="test-btn" id="request-permission">è«‹æ±‚é€šçŸ¥æ¬Šé™</button>
      <button class="test-btn" id="test-notification">æ¸¬è©¦åŸºæœ¬é€šçŸ¥</button>
      <button class="test-btn" id="test-sw-notification">æ¸¬è©¦ Service Worker é€šçŸ¥</button>
      <button class="test-btn" id="test-reminder">æ¸¬è©¦å†¥æƒ³æé†’</button>
      <button class="test-btn" id="clear-log">æ¸…é™¤æ—¥èªŒ</button>
    </div>
    
    <div class="log" id="log">
      <div class="log-entry log-info">ç³»çµ±åˆå§‹åŒ–ä¸­...</div>
    </div>
    
    <a href="/meditation.html" class="back-btn">â† è¿”å›å†¥æƒ³é é¢</a>
  </div>
  
  <script>
    // æ—¥èªŒåŠŸèƒ½
    function addLog(message, type = 'info') {
      const log = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }
    
    // æ›´æ–°ç‹€æ…‹é¡¯ç¤º
    function updateStatus(elementId, status, type = 'success') {
      const element = document.getElementById(elementId);
      element.textContent = status;
      element.className = `status-value status-${type}`;
    }
    
    // æª¢æŸ¥ç³»çµ±ç‹€æ…‹
    function checkSystemStatus() {
      addLog('é–‹å§‹æª¢æŸ¥ç³»çµ±ç‹€æ…‹...');
      
      // æª¢æŸ¥ Service Worker æ”¯æ´
      if ('serviceWorker' in navigator) {
        updateStatus('sw-support', 'æ”¯æ´', 'success');
        addLog('Service Worker æ”¯æ´å·²å•Ÿç”¨', 'success');
      } else {
        updateStatus('sw-support', 'ä¸æ”¯æ´', 'error');
        addLog('Service Worker ä¸æ”¯æ´', 'error');
      }
      
      // æª¢æŸ¥æ¨é€é€šçŸ¥æ”¯æ´
      if ('PushManager' in window) {
        updateStatus('push-support', 'æ”¯æ´', 'success');
        addLog('æ¨é€é€šçŸ¥æ”¯æ´å·²å•Ÿç”¨', 'success');
      } else {
        updateStatus('push-support', 'ä¸æ”¯æ´', 'error');
        addLog('æ¨é€é€šçŸ¥ä¸æ”¯æ´', 'error');
      }
      
      // æª¢æŸ¥é€šçŸ¥æ¬Šé™
      if ('Notification' in window) {
        const permission = Notification.permission;
        if (permission === 'granted') {
          updateStatus('notification-permission', 'å·²æˆæ¬Š', 'success');
          addLog('é€šçŸ¥æ¬Šé™å·²æˆæ¬Š', 'success');
        } else if (permission === 'denied') {
          updateStatus('notification-permission', 'å·²æ‹’çµ•', 'error');
          addLog('é€šçŸ¥æ¬Šé™å·²è¢«æ‹’çµ•', 'error');
        } else {
          updateStatus('notification-permission', 'æœªè¨­å®š', 'warning');
          addLog('é€šçŸ¥æ¬Šé™æœªè¨­å®š', 'warning');
        }
      } else {
        updateStatus('notification-permission', 'ä¸æ”¯æ´', 'error');
        addLog('é€šçŸ¥åŠŸèƒ½ä¸æ”¯æ´', 'error');
      }
      
      // æª¢æŸ¥ PWA ç‹€æ…‹
      if (window.matchMedia('(display-mode: standalone)').matches) {
        updateStatus('pwa-status', 'å·²å®‰è£', 'success');
        addLog('PWA å·²å®‰è£', 'success');
      } else {
        updateStatus('pwa-status', 'æœªå®‰è£', 'warning');
        addLog('PWA æœªå®‰è£', 'warning');
      }
    }
    
    // è¨»å†Š Service Worker
    async function registerServiceWorker() {
      if ('serviceWorker' in navigator) {
        try {
          const registration = await navigator.serviceWorker.register('/service-worker.js');
          addLog('Service Worker è¨»å†ŠæˆåŠŸ', 'success');
          return registration;
        } catch (error) {
          addLog(`Service Worker è¨»å†Šå¤±æ•—: ${error.message}`, 'error');
          return null;
        }
      }
      return null;
    }
    
    // è«‹æ±‚é€šçŸ¥æ¬Šé™
    async function requestNotificationPermission() {
      if ('Notification' in window) {
        try {
          const permission = await Notification.requestPermission();
          if (permission === 'granted') {
            addLog('é€šçŸ¥æ¬Šé™å·²ç²å¾—', 'success');
            updateStatus('notification-permission', 'å·²æˆæ¬Š', 'success');
          } else {
            addLog('é€šçŸ¥æ¬Šé™è¢«æ‹’çµ•', 'error');
            updateStatus('notification-permission', 'å·²æ‹’çµ•', 'error');
          }
        } catch (error) {
          addLog(`è«‹æ±‚æ¬Šé™å¤±æ•—: ${error.message}`, 'error');
        }
      } else {
        addLog('é€šçŸ¥åŠŸèƒ½ä¸æ”¯æ´', 'error');
      }
    }
    
    // æ¸¬è©¦åŸºæœ¬é€šçŸ¥
    function testBasicNotification() {
      if ('Notification' in window && Notification.permission === 'granted') {
        try {
          new Notification('åŸºæœ¬é€šçŸ¥æ¸¬è©¦', {
            body: 'é€™æ˜¯ä¸€å€‹åŸºæœ¬é€šçŸ¥æ¸¬è©¦',
            icon: '/favicon.ico'
          });
          addLog('åŸºæœ¬é€šçŸ¥å·²ç™¼é€', 'success');
        } catch (error) {
          addLog(`åŸºæœ¬é€šçŸ¥å¤±æ•—: ${error.message}`, 'error');
        }
      } else {
        addLog('ç„¡æ³•ç™¼é€åŸºæœ¬é€šçŸ¥ï¼Œè«‹å…ˆæˆæ¬Š', 'error');
      }
    }
    
    // æ¸¬è©¦ Service Worker é€šçŸ¥
    async function testServiceWorkerNotification() {
      if ('serviceWorker' in navigator) {
        try {
          const registration = await navigator.serviceWorker.ready;
          await registration.showNotification('Service Worker é€šçŸ¥æ¸¬è©¦', {
            body: 'é€™æ˜¯ä¸€å€‹ Service Worker é€šçŸ¥æ¸¬è©¦',
            icon: '/favicon.ico',
            badge: '/favicon.ico',
            tag: 'test-notification',
            requireInteraction: true,
            actions: [
              {
                action: 'open',
                title: 'é–‹å•Ÿæ‡‰ç”¨',
                icon: '/favicon.ico'
              }
            ],
            data: {
              url: window.location.href,
              timestamp: Date.now()
            }
          });
          addLog('Service Worker é€šçŸ¥å·²ç™¼é€', 'success');
        } catch (error) {
          addLog(`Service Worker é€šçŸ¥å¤±æ•—: ${error.message}`, 'error');
        }
      } else {
        addLog('Service Worker ä¸æ”¯æ´', 'error');
      }
    }
    
    // æ¸¬è©¦å†¥æƒ³æé†’
    async function testReminder() {
      if ('serviceWorker' in navigator) {
        try {
          const registration = await navigator.serviceWorker.ready;
          await registration.showNotification('å†¥æƒ³æé†’æ¸¬è©¦', {
            body: 'è©²æ˜¯å†¥æƒ³çš„æ™‚å€™äº†ï¼è®“æˆ‘å€‘ä¸€èµ·éœå¿ƒï¼Œæ„Ÿå—å…§åœ¨çš„å¯§éœã€‚',
            icon: '/favicon.ico',
            badge: '/favicon.ico',
            tag: 'meditation-reminder',
            requireInteraction: true,
            actions: [
              {
                action: 'open',
                title: 'é–‹å§‹å†¥æƒ³',
                icon: '/favicon.ico'
              },
              {
                action: 'snooze',
                title: 'ç¨å¾Œæé†’',
                icon: '/favicon.ico'
              }
            ],
            data: {
              url: '/meditation.html',
              timestamp: Date.now()
            }
          });
          addLog('å†¥æƒ³æé†’æ¸¬è©¦å·²ç™¼é€', 'success');
        } catch (error) {
          addLog(`å†¥æƒ³æé†’æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
        }
      } else {
        addLog('Service Worker ä¸æ”¯æ´', 'error');
      }
    }
    
    // æ¸…é™¤æ—¥èªŒ
    function clearLog() {
      const log = document.getElementById('log');
      log.innerHTML = '<div class="log-entry log-info">æ—¥èªŒå·²æ¸…é™¤</div>';
    }
    
    // äº‹ä»¶ç›£è½å™¨
    document.addEventListener('DOMContentLoaded', async () => {
      addLog('é é¢è¼‰å…¥å®Œæˆ');
      
      // æª¢æŸ¥ç³»çµ±ç‹€æ…‹
      checkSystemStatus();
      
      // è¨»å†Š Service Worker
      await registerServiceWorker();
      
      // ç¶å®šæŒ‰éˆ•äº‹ä»¶
      document.getElementById('request-permission').addEventListener('click', requestNotificationPermission);
      document.getElementById('test-notification').addEventListener('click', testBasicNotification);
      document.getElementById('test-sw-notification').addEventListener('click', testServiceWorkerNotification);
      document.getElementById('test-reminder').addEventListener('click', testReminder);
      document.getElementById('clear-log').addEventListener('click', clearLog);
      
      addLog('åˆå§‹åŒ–å®Œæˆ', 'success');
    });
  </script>
</body>
</html>
