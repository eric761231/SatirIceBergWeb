<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†¥æƒ³4æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            padding: 20px;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(30, 30, 45, 0.95);
            padding: 20px;
            border-radius: 10px;
        }
        .music-item {
            background: rgba(45, 45, 60, 0.8);
            margin-bottom: 20px;
            border-radius: 12px;
            padding: 20px;
        }
        .music-title {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        audio {
            width: 100%;
            margin-bottom: 15px;
        }
        .creed-container {
            margin-top: 15px;
        }
        .creed-toggle {
            background: #0f3460;
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .creed-content {
            background: rgba(45, 45, 60, 0.7);
            border-radius: 8px;
            padding: 15px;
            color: #f5f5f5;
            white-space: pre-line;
        }
        .hide {
            display: none;
        }
        .creed-pair {
            margin-bottom: 10px;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }
        .debug-info {
            background: #333;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§˜â€â™‚ï¸ å†¥æƒ³4 æˆ°å£«ä¿¡æ¢æ¸¬è©¦</h1>
        
        <div class="music-item">
            <div class="music-title">æº¯æºå†¥æƒ³4 Warrior's Creed</div>
            <audio controls preload="none" id="warrior-audio">
                <source src="meditationMusic/meditation4_warriorscreed.mp3" type="audio/mpeg">
                æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´éŸ³é »æ’­æ”¾ã€‚
            </audio>
            <div class="creed-container">
                <button class="creed-toggle" id="creed-toggle" aria-expanded="false">
                    â–¶ æˆ°å£«çš„ä¿¡æ¢
                </button>
                <div class="creed-content hide" id="creed-content"></div>
            </div>
        </div>
        
        <div class="debug-info" id="debug-info">
            èª¿è©¦ä¿¡æ¯å°‡é¡¯ç¤ºåœ¨é€™è£¡...
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggle = document.getElementById('creed-toggle');
            const content = document.getElementById('creed-content');
            const warriorAudio = document.getElementById('warrior-audio');
            const debugInfo = document.getElementById('debug-info');
            
            let loaded = false;
            
            function log(message) {
                const timestamp = new Date().toLocaleTimeString();
                debugInfo.innerHTML += `[${timestamp}] ${message}<br>`;
                console.log(message);
            }
            
            log('é é¢è¼‰å…¥å®Œæˆ');
            log(`æ‰¾åˆ°éŸ³é »å…ƒç´ : ${warriorAudio ? 'æ˜¯' : 'å¦'}`);
            log(`æ‰¾åˆ°åˆ‡æ›æŒ‰éˆ•: ${toggle ? 'æ˜¯' : 'å¦'}`);
            log(`æ‰¾åˆ°å…§å®¹å€åŸŸ: ${content ? 'æ˜¯' : 'å¦'}`);
            
            function showCreedAnimated(pairs) {
                content.innerHTML = '';
                let idx = 0;
                
                function showNext() {
                    if (idx >= pairs.length) return;
                    var group = document.createElement('div');
                    group.className = 'creed-pair';
                    group.style.opacity = 0;
                    group.innerHTML = `<div>${pairs[idx][0]}</div><div>${pairs[idx][1]}</div>`;
                    content.appendChild(group);
                    setTimeout(() => {
                        group.style.transition = 'opacity 0.4s ease-in-out';
                        group.style.opacity = 1;
                        idx++;
                        setTimeout(showNext, 180);
                    }, 10);
                }
                showNext();
            }
            
            function autoExpandCreed() {
                log('è‡ªå‹•å±•é–‹ä¿¡æ¢è¢«èª¿ç”¨');
                var expanded = toggle.getAttribute('aria-expanded') === 'true';
                if (!expanded) {
                    toggle.setAttribute('aria-expanded', 'true');
                    content.classList.remove('hide');
                    toggle.innerHTML = 'â–¼ æˆ°å£«çš„ä¿¡æ¢';
                    
                    if (!loaded) {
                        var base = "./warrior'sCreed/warror'sCreed.txt";
                        log(`æ­£åœ¨è¼‰å…¥æˆ°å£«ä¿¡æ¢æ–‡ä»¶: ${base}`);
                        
                        fetch(base)
                            .then(function(response) { 
                                log('æˆ°å£«ä¿¡æ¢æ–‡ä»¶è¼‰å…¥æˆåŠŸ');
                                return response.text(); 
                            })
                            .then(function(text) {
                                log(`æˆ°å£«ä¿¡æ¢æ–‡æœ¬å…§å®¹è¼‰å…¥å®Œæˆï¼Œé•·åº¦: ${text.length}`);
                                var lines = text.split(/\r?\n/).filter(Boolean);
                                var pairs = [];
                                for (var i = 0; i < lines.length - 1; i += 2) {
                                    pairs.push([lines[i], lines[i + 1]]);
                                }
                                log(`è§£æå‡º ${pairs.length} å°ä¿¡æ¢å…§å®¹`);
                                showCreedAnimated(pairs);
                                content.setAttribute('data-lines', lines.join(','));
                                loaded = true;
                            })
                            .catch(function(error) {
                                log(`è¼‰å…¥æˆ°å£«ä¿¡æ¢æ–‡ä»¶å¤±æ•—: ${error}`);
                                content.textContent = 'ç„¡æ³•è¼‰å…¥ä¿¡æ¢å…§å®¹ã€‚';
                            });
                    } else {
                        var lines = content.getAttribute('data-lines').split(',').filter(Boolean);
                        var pairs = [];
                        for (var i = 0; i < lines.length - 1; i += 2) {
                            pairs.push([lines[i], lines[i + 1]]);
                        }
                        showCreedAnimated(pairs);
                    }
                }
            }
            
            // æ‰‹å‹•é»æ“Šåˆ‡æ›
            toggle.addEventListener('click', function() {
                log('æ‰‹å‹•é»æ“Šåˆ‡æ›æŒ‰éˆ•');
                var expanded = toggle.getAttribute('aria-expanded') === 'true';
                toggle.setAttribute('aria-expanded', !expanded);
                
                if (expanded) {
                    content.classList.add('hide');
                    toggle.innerHTML = 'â–¶ æˆ°å£«çš„ä¿¡æ¢';
                } else {
                    content.classList.remove('hide');
                    toggle.innerHTML = 'â–¼ æˆ°å£«çš„ä¿¡æ¢';
                    
                    if (!loaded) {
                        var base = "./warrior'sCreed/warror'sCreed.txt";
                        log(`æ‰‹å‹•é»æ“Šè¼‰å…¥æˆ°å£«ä¿¡æ¢æ–‡ä»¶: ${base}`);
                        
                        fetch(base)
                            .then(function(response) { 
                                log('æ‰‹å‹•è¼‰å…¥æˆ°å£«ä¿¡æ¢æ–‡ä»¶æˆåŠŸ');
                                return response.text(); 
                            })
                            .then(function(text) {
                                log(`æ‰‹å‹•è¼‰å…¥æˆ°å£«ä¿¡æ¢æ–‡æœ¬å®Œæˆï¼Œé•·åº¦: ${text.length}`);
                                var lines = text.split(/\r?\n/).filter(Boolean);
                                var pairs = [];
                                for (var i = 0; i < lines.length - 1; i += 2) {
                                    pairs.push([lines[i], lines[i + 1]]);
                                }
                                log(`æ‰‹å‹•è§£æå‡º ${pairs.length} å°ä¿¡æ¢å…§å®¹`);
                                showCreedAnimated(pairs);
                                content.setAttribute('data-lines', lines.join(','));
                                loaded = true;
                            })
                            .catch(function(error) {
                                log(`æ‰‹å‹•è¼‰å…¥æˆ°å£«ä¿¡æ¢æ–‡ä»¶å¤±æ•—: ${error}`);
                                content.textContent = 'ç„¡æ³•è¼‰å…¥ä¿¡æ¢å…§å®¹ã€‚';
                            });
                    } else {
                        var lines = content.getAttribute('data-lines').split(',').filter(Boolean);
                        var pairs = [];
                        for (var i = 0; i < lines.length - 1; i += 2) {
                            pairs.push([lines[i], lines[i + 1]]);
                        }
                        showCreedAnimated(pairs);
                    }
                }
            });
            
            // éŸ³é »æ’­æ”¾äº‹ä»¶
            if (warriorAudio) {
                log('ç¶å®šéŸ³é »æ’­æ”¾äº‹ä»¶');
                warriorAudio.addEventListener('play', function() {
                    log('æˆ°å£«éŸ³é »é–‹å§‹æ’­æ”¾ï¼Œæº–å‚™è‡ªå‹•å±•é–‹ä¿¡æ¢');
                    setTimeout(autoExpandCreed, 200);
                });
                
                warriorAudio.addEventListener('pause', function() {
                    log('æˆ°å£«éŸ³é »æš«åœ');
                });
                
                warriorAudio.addEventListener('ended', function() {
                    log('æˆ°å£«éŸ³é »æ’­æ”¾çµæŸ');
                });
            } else {
                log('éŒ¯èª¤ï¼šæœªæ‰¾åˆ°æˆ°å£«éŸ³é »å…ƒç´ ');
            }
        });
    </script>
</body>
</html>
