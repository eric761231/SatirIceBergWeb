# 手機端提醒功能說明

## 問題描述
提醒功能在手機上沒有效果，主要原因包括：

1. **缺少 Service Worker 註冊** - 原來的 `meditation.html` 沒有註冊 Service Worker
2. **缺少 PWA 配置** - 沒有正確的 PWA meta 標籤和 manifest 連結
3. **通知權限問題** - 手機端需要特殊處理通知權限
4. **背景執行限制** - 手機端對背景執行有嚴格限制

## 已修復的問題

### 1. 添加了 PWA 支援
- ✅ 在 `meditation.html` 中添加了完整的 PWA meta 標籤
- ✅ 連結了 manifest.json 檔案
- ✅ 添加了 Apple Touch Icons 支援
- ✅ 註冊了 Service Worker

### 2. 改進了 Service Worker
- ✅ 添加了完整的推送通知處理
- ✅ 添加了通知點擊事件處理
- ✅ 添加了背景同步功能
- ✅ 添加了訊息處理機制

### 3. 改進了提醒功能
- ✅ 使用 Service Worker 處理背景通知
- ✅ 添加了本地儲存功能
- ✅ 添加了提醒設定恢復功能
- ✅ 改進了通知權限處理

### 4. 創建了測試工具
- ✅ 創建了 `notification-test.html` 測試頁面
- ✅ 提供完整的系統狀態檢查
- ✅ 提供多種通知測試功能

## 使用步驟

### 1. 安裝 PWA
1. 在手機瀏覽器中開啟網站
2. 點擊瀏覽器的「安裝」或「添加到主畫面」選項
3. 或者按照瀏覽器提示手動安裝

### 2. 設定提醒
1. 開啟冥想頁面 (`meditation.html`)
2. 點擊「提醒設定」按鈕
3. 設定提醒時間和頻率
4. 點擊「儲存設定」

### 3. 測試通知功能
1. 點擊「通知測試」按鈕
2. 在測試頁面中檢查系統狀態
3. 點擊「請求通知權限」
4. 測試各種通知功能

## 手機端特殊注意事項

### iOS (iPhone/iPad)
- 必須安裝為 PWA 才能使用通知功能
- 需要在 Safari 中手動添加到主畫面
- 通知權限需要在 PWA 模式下重新授權

### Android
- 支援自動安裝提示
- 通知權限通常在安裝時自動授權
- 某些品牌手機可能有額外的省電模式限制

### 通用問題解決
1. **通知不顯示** - 檢查是否已安裝 PWA
2. **權限被拒絕** - 在瀏覽器設定中重新授權
3. **背景執行被限制** - 關閉省電模式
4. **Service Worker 未註冊** - 重新載入頁面

## 技術細節

### Service Worker 功能
- 背景通知處理
- 推送事件處理
- 通知點擊處理
- 訊息傳遞機制

### 通知類型
- 基本通知 (測試用)
- Service Worker 通知 (推薦)
- 冥想提醒通知 (主要功能)

### 儲存機制
- localStorage 儲存提醒設定
- 頁面載入時自動恢復設定
- Service Worker 背景執行

## 故障排除

### 檢查清單
- [ ] 是否已安裝 PWA
- [ ] 通知權限是否已授權
- [ ] Service Worker 是否已註冊
- [ ] 瀏覽器是否支援通知功能
- [ ] 是否關閉了省電模式

### 常見錯誤
1. **"Service Worker 註冊失敗"** - 檢查網路連接
2. **"通知權限被拒絕"** - 手動在設定中授權
3. **"推送通知不支援"** - 更新瀏覽器版本
4. **"PWA 未安裝"** - 按照安裝步驟操作

## 更新日誌

### v1.1.0 (最新)
- 添加完整的 PWA 支援
- 改進 Service Worker 功能
- 創建通知測試工具
- 修復手機端提醒問題

### v1.0.0 (原始)
- 基本提醒功能
- 簡單的通知支援

## 支援的瀏覽器

### 完全支援
- Chrome (Android)
- Edge (Android)
- Safari (iOS 14.5+)

### 部分支援
- Firefox (Android)
- Samsung Internet

### 不支援
- 舊版瀏覽器
- 不支援 Service Worker 的瀏覽器
