# 冥想應用程式背景提醒功能說明

## 功能概述

本應用程式的提醒功能已經過改進，現在可以在應用程式關閉時也能正常發送提醒通知。這得益於 Service Worker 技術的應用，實現了真正的背景提醒功能。

## 技術架構

### 1. Service Worker 背景處理
- **Service Worker 註冊**: 應用程式啟動時自動註冊 Service Worker
- **背景檢查**: Service Worker 每30秒檢查一次提醒設定
- **持久化儲存**: 使用 Cache API 儲存提醒設定，確保重啟後仍能恢復

### 2. 多重觸發機制
- **定期檢查**: Service Worker 內建定時器，每30秒檢查一次
- **背景同步**: 使用 Background Sync API 處理離線情況
- **推送通知**: 支援推送通知作為備用方案

### 3. 通知權限管理
- **權限請求**: 首次使用時自動請求通知權限
- **權限檢查**: 定期檢查通知權限狀態
- **降級處理**: 如果權限被拒絕，提供備用方案

## 使用方式

### 1. 設定提醒
1. 開啟冥想應用程式
2. 點擊底部的提醒按鈕（時鐘圖示）
3. 設定提醒時間、頻率和訊息
4. 點擊「儲存設定」

### 2. 提醒頻率選項
- **每日**: 每天在指定時間發送提醒
- **工作日**: 週一至週五發送提醒
- **自訂**: 選擇特定星期幾發送提醒

### 3. 通知操作
收到提醒通知後，可以：
- **開始冥想**: 直接開啟應用程式
- **稍後提醒**: 10分鐘後再次提醒

## 技術特點

### 1. 背景執行
- ✅ 應用程式關閉時仍能發送提醒
- ✅ 系統重啟後自動恢復提醒設定
- ✅ 離線時也能正常運作

### 2. 可靠性保證
- ✅ 多重檢查機制，避免重複通知
- ✅ 錯誤處理和降級方案
- ✅ 自動恢復機制

### 3. 使用者體驗
- ✅ 無需保持應用程式開啟
- ✅ 通知包含操作按鈕
- ✅ 支援延遲提醒功能

## 測試功能

### 1. 提醒測試頁面
訪問 `reminder-test.html` 可以：
- 測試通知權限
- 檢查 Service Worker 狀態
- 立即發送測試通知
- 設定測試提醒（1分鐘後）
- 查看當前提醒設定

### 2. 測試步驟
1. 開啟提醒測試頁面
2. 點擊「請求通知權限」
3. 點擊「註冊 Service Worker」
4. 點擊「立即發送測試通知」
5. 點擊「設定測試提醒（1分鐘後）」
6. 關閉應用程式，等待1分鐘後查看通知

## 故障排除

### 1. 通知不顯示
- 檢查瀏覽器通知權限設定
- 確認系統通知設定
- 檢查瀏覽器是否支援 Service Worker

### 2. 提醒不準時
- 檢查系統時間設定
- 確認瀏覽器背景執行權限
- 檢查電池最佳化設定

### 3. 設定遺失
- 清除瀏覽器快取可能導致設定遺失
- 建議定期備份提醒設定

## 瀏覽器支援

### 完全支援
- Chrome 42+
- Firefox 44+
- Edge 17+
- Safari 11.1+

### 部分支援
- 舊版瀏覽器可能無法使用背景提醒功能
- 建議使用最新版瀏覽器

## 隱私保護

- 提醒設定僅儲存在本地裝置
- 不會向外部伺服器發送個人資料
- 通知內容完全由使用者自訂

## 更新日誌

### v1.0.3 (最新)
- ✅ 改進背景提醒可靠性
- ✅ 新增 Service Worker 自動恢復機制
- ✅ 優化通知觸發邏輯
- ✅ 新增提醒測試頁面
- ✅ 改進錯誤處理和日誌記錄

### v1.0.2
- ✅ 基本背景提醒功能
- ✅ Service Worker 支援
- ✅ 通知權限管理

### v1.0.1
- ✅ 基本提醒功能
- ✅ 本地通知支援

---

**注意**: 背景提醒功能需要現代瀏覽器支援。如果遇到問題，請確保使用最新版瀏覽器並授予必要的權限。
