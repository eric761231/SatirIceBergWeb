<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ OAuth è¨ºæ–·å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .error {
            background: #fff5f5;
            border: 2px solid #fed7d7;
            color: #c53030;
        }
        .success {
            background: #f0fff4;
            border: 2px solid #9ae6b4;
            color: #22543d;
        }
        .warning {
            background: #fffbf0;
            border: 2px solid #fbd38d;
            color: #c05621;
        }
        .info {
            background: #ebf8ff;
            border: 2px solid #90cdf4;
            color: #2a69ac;
        }
        h1 { color: #2d3748; margin-bottom: 8px; }
        h2 { color: #4a5568; margin-top: 24px; margin-bottom: 12px; }
        code {
            background: #f7fafc;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: Monaco, Consolas, monospace;
        }
        .btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px 4px;
            font-size: 14px;
        }
        .btn:hover { background: #3182ce; }
        .btn-success { background: #48bb78; }
        .btn-success:hover { background: #38a169; }
        .btn-danger { background: #e53e3e; }
        .btn-danger:hover { background: #c53030; }
        pre {
            background: #f7fafc;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Google OAuth è¨ºæ–·å·¥å…·</h1>
    <p>æª¢æ¸¬å’Œä¿®å¾© OAuth é…ç½®å•é¡Œ</p>
    
    <div class="card error">
        <h2>âŒ ç•¶å‰éŒ¯èª¤</h2>
        <p><strong>éŒ¯èª¤ 400ï¼šorigin_mismatch</strong></p>
        <p>ä¾†æºï¼š<code>http://localhost:8080</code></p>
        <p>æµç¨‹ï¼š<code>GeneralOAuthFlow</code></p>
    </div>
    
    <div class="status-grid">
        <div class="card" id="server-status">
            <h3>ğŸ–¥ï¸ æœå‹™å™¨ç‹€æ…‹</h3>
            <p id="server-info">æª¢æ¸¬ä¸­...</p>
        </div>
        
        <div class="card" id="oauth-status">
            <h3>ğŸ” OAuth è¨­å®š</h3>
            <p id="oauth-info">æª¢æ¸¬ä¸­...</p>
        </div>
        
        <div class="card" id="pwa-status">
            <h3>ğŸ“± PWA ç‹€æ…‹</h3>
            <p id="pwa-info">æª¢æ¸¬ä¸­...</p>
        </div>
        
        <div class="card" id="icon-status">
            <h3>ğŸ¨ åœ–æ¨™ç‹€æ…‹</h3>
            <p id="icon-info">æª¢æ¸¬ä¸­...</p>
        </div>
    </div>
    
    <div class="card info">
        <h2>ğŸ”§ ä¿®å¾©æ­¥é©Ÿ</h2>
        <h3>1. ç«‹å³ä¿®å¾©ï¼ˆæ¨è–¦ï¼‰</h3>
        <p>åœ¨ Google Cloud Console ä¸­æ·»åŠ æˆæ¬Šä¾†æºï¼š</p>
        <pre>http://localhost:8080
http://127.0.0.1:8080
https://satir-ice-berg-web.vercel.app</pre>
        
        <div>
            <button class="btn btn-success" onclick="openGoogleConsole()">
                ğŸš€ é–‹å•Ÿ Google Cloud Console
            </button>
            <button class="btn" onclick="openDocumentation()">
                ğŸ“– æŸ¥çœ‹è©³ç´°æ•™å­¸
            </button>
        </div>
        
        <h3>2. è‡¨æ™‚è§£æ±ºæ–¹æ¡ˆ</h3>
        <p>ä½¿ç”¨æ¸¬è©¦æ¨¡å¼è·³é OAuth ç™»å…¥ï¼š</p>
        <div>
            <button class="btn btn-success" onclick="openTestMode()">
                ğŸ§ª é€²å…¥æ¸¬è©¦æ¨¡å¼
            </button>
            <button class="btn" onclick="generateIcons()">
                ğŸ¨ ç”Ÿæˆ PWA åœ–æ¨™
            </button>
        </div>
    </div>
    
    <div class="card warning">
        <h2>â° é‡è¦æé†’</h2>
        <ul>
            <li>OAuth è¨­å®šè®Šæ›´éœ€è¦ <strong>5-10 åˆ†é˜</strong> æ‰æœƒç”Ÿæ•ˆ</li>
            <li>ä¿®æ”¹å¾Œè«‹æ¸…é™¤ç€è¦½å™¨å¿«å–ä¸¦é‡æ–°è¼‰å…¥</li>
            <li>ç¢ºä¿ä½¿ç”¨æ­£ç¢ºçš„ Client ID</li>
            <li>æœ¬åœ°é–‹ç™¼ä½¿ç”¨ HTTPï¼Œç”Ÿç”¢ç’°å¢ƒä½¿ç”¨ HTTPS</li>
        </ul>
    </div>
    
    <div class="card">
        <h2>ğŸ¯ å¿«é€Ÿæ¸¬è©¦</h2>
        <div>
            <button class="btn" onclick="testMainApp()">
                ğŸ  æ¸¬è©¦ä¸»æ‡‰ç”¨
            </button>
            <button class="btn" onclick="testPWA()">
                ğŸ“± æ¸¬è©¦ PWA åŠŸèƒ½
            </button>
            <button class="btn" onclick="testOffline()">
                ğŸ”Œ æ¸¬è©¦é›¢ç·šåŠŸèƒ½
            </button>
        </div>
    </div>

    <script>
        // æª¢æ¸¬ç‹€æ…‹
        async function checkStatus() {
            // æª¢æ¸¬æœå‹™å™¨
            try {
                const response = await fetch('/manifest.json');
                if (response.ok) {
                    document.getElementById('server-info').innerHTML = 'âœ… æœå‹™å™¨é‹è¡Œæ­£å¸¸<br><small>ç«¯å£: 8080</small>';
                    document.getElementById('server-status').className = 'card success';
                } else {
                    throw new Error('æœå‹™å™¨éŸ¿æ‡‰ç•°å¸¸');
                }
            } catch (error) {
                document.getElementById('server-info').innerHTML = 'âŒ æœå‹™å™¨é€£æ¥å¤±æ•—<br><small>' + error.message + '</small>';
                document.getElementById('server-status').className = 'card error';
            }
            
            // æª¢æ¸¬ OAuth
            const clientId = '28263511849-3rk0avke93rn8rfdi5hq0boffkp6gm0j.apps.googleusercontent.com';
            document.getElementById('oauth-info').innerHTML = `âš ï¸ éœ€è¦ä¿®å¾©<br><small>Client ID: ${clientId.substring(0, 20)}...</small>`;
            document.getElementById('oauth-status').className = 'card warning';
            
            // æª¢æ¸¬ PWA
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration('/sw.js');
                    if (registration) {
                        document.getElementById('pwa-info').innerHTML = 'âœ… Service Worker å·²è¨»å†Š<br><small>PWA åŠŸèƒ½æ­£å¸¸</small>';
                        document.getElementById('pwa-status').className = 'card success';
                    } else {
                        document.getElementById('pwa-info').innerHTML = 'âš ï¸ Service Worker æœªè¨»å†Š<br><small>æ­£åœ¨è¨»å†Šä¸­...</small>';
                        document.getElementById('pwa-status').className = 'card warning';
                    }
                } catch (error) {
                    document.getElementById('pwa-info').innerHTML = 'âŒ PWA æª¢æ¸¬å¤±æ•—<br><small>' + error.message + '</small>';
                    document.getElementById('pwa-status').className = 'card error';
                }
            } else {
                document.getElementById('pwa-info').innerHTML = 'âŒ ç€è¦½å™¨ä¸æ”¯æ´ PWA<br><small>è«‹ä½¿ç”¨ç¾ä»£ç€è¦½å™¨</small>';
                document.getElementById('pwa-status').className = 'card error';
            }
            
            // æª¢æ¸¬åœ–æ¨™
            checkIcons();
        }
        
        async function checkIcons() {
            const iconSizes = ['72x72', '96x96', '128x128', '144x144', '152x152', '192x192', '384x384', '512x512'];
            let successCount = 0;
            
            for (const size of iconSizes) {
                try {
                    const response = await fetch(`/icons/icon-${size}.png`);
                    if (response.ok) successCount++;
                } catch (error) {
                    // å¿½ç•¥éŒ¯èª¤
                }
            }
            
            if (successCount === iconSizes.length) {
                document.getElementById('icon-info').innerHTML = `âœ… æ‰€æœ‰åœ–æ¨™å®Œæ•´<br><small>${successCount}/${iconSizes.length} å€‹åœ–æ¨™</small>`;
                document.getElementById('icon-status').className = 'card success';
            } else if (successCount > 0) {
                document.getElementById('icon-info').innerHTML = `âš ï¸ éƒ¨åˆ†åœ–æ¨™ç¼ºå¤±<br><small>${successCount}/${iconSizes.length} å€‹åœ–æ¨™</small>`;
                document.getElementById('icon-status').className = 'card warning';
            } else {
                document.getElementById('icon-info').innerHTML = `âŒ åœ–æ¨™å°šæœªç”Ÿæˆ<br><small>éœ€è¦ç”Ÿæˆ PWA åœ–æ¨™</small>`;
                document.getElementById('icon-status').className = 'card error';
            }
        }
        
        // åŠŸèƒ½å‡½æ•¸
        function openGoogleConsole() {
            window.open('https://console.cloud.google.com/apis/credentials', '_blank');
        }
        
        function openDocumentation() {
            window.open('/OAUTH_FIX_DETAILED.md', '_blank');
        }
        
        function openTestMode() {
            window.location.href = '/test.html';
        }
        
        function generateIcons() {
            window.open('/icon-generator.html', '_blank');
        }
        
        function testMainApp() {
            window.location.href = '/';
        }
        
        function testPWA() {
            window.location.href = '/test.html';
        }
        
        function testOffline() {
            alert('è«‹æ‰‹å‹•é—œé–‰ç¶²è·¯é€£ç·šæ¸¬è©¦é›¢ç·šåŠŸèƒ½');
        }
        
        // åˆå§‹åŒ–
        checkStatus();
        
        // å®šæœŸæ›´æ–°ç‹€æ…‹
        setInterval(checkStatus, 30000);
    </script>
</body>
</html>
